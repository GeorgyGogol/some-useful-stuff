* [Содержание](../../TableOfContent.md)
* [Вверх](../Readme.md)

# Cmake

Раздел, посвященный системе сборки CMake

Официальный сайт: https://cmake.org

# Содержание раздела

* Функции
  * [Базовые заклинания](Functions/Base.md)
  * [Некоторые дополнительные штуки](Functions/Additional.md)
  * [Дополнительные приколдесы](Functions/ExternalFunctions.md)
* [Переменные](Variables.md)
  * [Информационные](Variables.md#информационные-переменные)
  * [Поведения](Variables.md#переменные-поведения)
* Работа в консоли
* [Физическая организация проекта](../../ProjectOrganisation/PhysProjOrg/CMake.md)
* Qt
  * [Включение Qt](QtWithCmake/CmakeQt.md)
  * [Компилирование Qt](QtWithCmake/CompileQt.md)

## Примеры

Для проекта нужно всего ничего - файл CMakeLists.txt и несколько колдовских слов. При изучении очень не хватало сначала посмотреть на общую картину, так что начну с примерно общего файла. Тут я постарался нарисовать основы, которые используются для написания CMakeLists.txt

```cmake
# Блок комментариев начинается с решетки

# Объявим минимальную версию CMake
cmake_minimum_required(VERSION 3.15) # См. в подробнее

# Определяем название проекта, версию и язык соответственно
project(
    ProjectName
    VERSION 0.1.0
    LANGUAGES CXX
)
# Эти строчки устанавливают требования к используемой версии языка C++
set(CMAKE_CXX_STANDARD 26) # <- Версия С++
set(CMAKE_CXX_STANDARD_REQUIRED True) # <- Ошибка, если такой версии нет
set(CMAKE_CXX_EXTENSIONS OFF) # <- Вот в этом не разобрался и как-то не хочется

# Вот эта штучка задает настройку сборки
option(ProjectName_LIB "Buid as lib" OFF)

# Это пример и объявления переменной, и сбора исходников проекта в одно место
set(
    SOURCES
    SomeClass.h
    SomeClass.cpp
    "Utils/ISomeUtil.h"
)
# Теперь мы можем обратиться к этой вещи через ${SOURCES}

# Тоже самое, только для директорий
set(
    INCLUDE_DIRS
    Utils
)

# Пример условного оператора
if(ProjectName_LIB)
    # Это вариант для ProjectName_LIB = ON
    # Собираем библиотеку динамической компановки
    add_library(ProjectName SHARED ${SOURCES})
    # Делаем алиас на модуль
    add_library(modules::ProjectName ALIAS ProjectName)
else()
    # Собираем исполняемый exe (если для винды)
    add_executable(ProjectName STATIC main.cpp )
endif(ProjectName_LIB) # Не обязательно, можно проще: endif()

# Теперь скажем, какие директории включаются в проект
target_include_directories(ProjectName PRIVATE ${INCLUDE_DIRS})
# А вот тут, какие файлы с исходным кодом добавить
target_sources(ProjectName PRIVATE ${SOURCES})

# Добавление поддиректории
add_subdirectory(subDir)
```

# Более подробно

CMake широко использует файловую систему и управляет многими папками и файлами. CMake поддерживает сборку вне расположения проекта. Местоположение проекта называется исходной папкой (Source Directory). При генерации CMake сохраняет файлы в папку сборки (Build Directory). В некоторых контекстах папка сборки также именуется папкой бинарных артефактов(Binary Directory), как противопоставление исходной папке. При выполнении шага установки начинает фигурировать директория установки (Install directory). Эти местоположения могут указывать в одно место, или в разные - это контролируется независимо и доступно при использовании.

Поддержка CMake в проектах обеспечивается CMakeLists.txt файлом, обычно расположенным в корне проекта. Этих файлов может быть несколько и они могут быть включены друг в друга различными способами. Основная идея этого файла - он предоставляет главную точку входа для CMake и описание проекта начинается с него.

В папке сборки после генерации можно найти файл CMakeCache.txt. Этот файл содержит полное представление всего проекта, которое CMake смог разобрать и сгенерировать. Этот файл может быть отредактирован вручную, для изменения некоторых параметров и переменных. Однако, при следующей генерации изменения могут быть утеряны, если параметры и аргументы запуска CMake утилиты изменились.

Файлы, имена которых регистро-зависимо оканчиваются на `Config.cmake` или `-config.cmake`, являются файлами CMake совместимой конфигурации библиотек и зависимостей. (CMake config files). Эти файлы как правило распространяются вместе с библиотеками и обеспечивают интеграции библиотек в проекты использующие CMake для сборки.

Файлы, имена который выглядят как `Find*.cmake` , содержат CMake модули(CMake modules). Модули расширяют функционал CMake, и используются в CMakeLists.txt для выполнения рутинных задач. Модули следует использовать как фреймворк или библиотеку функций при написании своего CMakeLists.txt

# Соус

За основу взято:

* Внешние ссылки в документах
* https://habr.com/ru/articles/535602/
* https://habr.com/ru/articles/683204/
* https://habr.com/ru/articles/461817/

